"use strict";angular.module("ra.form",[]),angular.module("ra.form").directive("errorFor",function(){return{restrict:"A",replace:!0,scope:!0,template:'<p class="form-error" ng-show="errors.length > 0" ng-transclude></p>',transclude:!0,controller:["$scope","$element","$attrs",function(a,b,c){a.errors=[],this.show=function(b){_.contains(a.errors,b)||a.errors.push(b)},this.hide=function(b){a.errors=_.reject(a.errors,b)},this.name=c.errorFor}]}}).directive("errorOn",function(){return{require:["^form","?^errorFor"],restrict:"A",replace:!0,scope:!0,template:'<span class="text-danger" ng-show="show_error" ng-transclude></span>',transclude:!0,link:function(a,b,c,d){function e(a){return a.replace(/^[\s\uFEFF]+|[\s\uFEFF]+$/g,"")}var f,g,h=d[0],i=d[1];if(i)f=i.name,g=c.errorOn;else{var j=c.errorOn.split(",");f=e(j[0]),g=e(j[1])}var k=function(){var b=a[h.$name]&&a[h.$name][f];return b},l=function(){var a=k();return!(!a||!a.$error[g])},m=function(){var a=k();return!(!a||!a.show_errors)};a.$watch(m,function(a){a===!0&&l()===!0?n():o()}),a.$watch(l,function(a){m()===!0&&a===!0?n():o()});var n=function(){a.show_error=!0,i&&i.show(g)},o=function(){a.show_error=!1,i&&i.hide(g)}}}}),angular.module("ra.form").directive("raForm",["raForm",function(a){return{restrict:"A",require:["raForm","form"],controller:function(){return new a},link:function(b,c,d,e){var f=e[0],g=e[1],h=b.$eval(d.raForm);if(_.isUndefined(h)||_.isFunction(h.update)===!1)throw new Error('You must provide an update callback. e.g. <form ra-form="form_events">,where $scope.form_events = { update: callbackFn }');f.setFields(g),_.extend(g,f),_.extend(g,a.prototype),_.extend(g,h)}}}]),angular.module("ra.form").directive("validateOn",function(){return{require:["^raForm","ngModel"],restrict:"A",link:function(a,b,c,d){var e=d[0],f=d[1],g=function(){"blur"===c.validateOn?h():"submit"===c.validateOn&&i()},h=function(){_.each("focus blur".split(" "),function(c){b.on(c,function(){a.$apply(function(){e[c](f.$name)})})})},i=function(){e.onSubmit(function(){e.blur(f.$name)})},j=a.$watch(function(){return e.initialized},function(){j(),g()})}}}),angular.module("ra.form").factory("raForm",function(){var a=function(){this.initialized=!0,this.submitting=!1,this.submitCallbacks=[]};return _.extend(a.prototype,{showErrors:function(a){var b=this.getField(a);b&&(b.show_errors=!0)},hideErrors:function(a){var b=this.getField(a);b&&(b.show_errors=!1)},showErrorsOnInValid:function(){var a=this;_.each(a.$error,function(b){_.each(b,function(b){a.showErrors(b.$name)})})},setValidity:function(a,b,c){var d=this.getField(a);d&&d.$setValidity(b,c),c===!0?this.hideErrors(a):this.showErrors(a)},setFields:function(a){this.fields=a},getField:function(a){return this.fields&&this.fields[a]},errorOn:function(a,b){var c=this.getField(a);return c&&c.show_errors?c.show_errors&&c.$error[b]:void 0},focus:function(a){this.hideErrors(a)},blur:function(a){this.change(a),this.showErrors(a)},change:function(a){if(this.validations){var b=this.validations[a];_.isFunction(b)&&b()}},onSubmit:function(a){this.submitCallbacks.push(a)},submit:function(){var a=!0;_.each(this.submitCallbacks,function(a){_.isFunction(a)&&a()}),_.isFunction(this.validation)&&(a=this.validation()),this.$valid&&a!==!1?(this.submitting=!0,this.update()):this.showErrorsOnInValid()}}),a});